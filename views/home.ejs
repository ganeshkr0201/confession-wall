<%- include('partials/header') %>

<div class="container">
  <% if (error) { %>
    <div class="alert alert-error">
      <i class="fas fa-exclamation-circle"></i>
      <span><%= error %></span>
    </div>
  <% } %>
  
  <% if (success) { %>
    <div class="alert alert-success">
      <i class="fas fa-check-circle"></i>
      <span><%= success %></span>
    </div>
  <% } %>

  <!-- Page Header with CTA -->
  <div class="home-header">
    <div class="home-header-content">
      <h1>Confessions</h1>
      <p>Share your thoughts anonymously and connect with others</p>
    </div>
    <a href="/confessions/new" class="btn btn-primary">
      <i class="fas fa-plus"></i>
      New Confession
    </a>
  </div>

  <!-- Stats Overview -->
  <div class="home-stats">
    <div class="home-stat-card">
      <div class="home-stat-icon blue">
        <i class="fas fa-comment-dots"></i>
      </div>
      <div class="home-stat-content">
        <div class="home-stat-value"><%= totalConfessions %></div>
        <div class="home-stat-label">Total Confessions</div>
      </div>
    </div>

    <div class="home-stat-card">
      <div class="home-stat-icon green">
        <i class="fas fa-user-edit"></i>
      </div>
      <div class="home-stat-content">
        <div class="home-stat-value"><%= userConfessions %></div>
        <div class="home-stat-label">Your Confessions</div>
      </div>
    </div>

    <div class="home-stat-card">
      <div class="home-stat-icon purple">
        <i class="fas fa-heart"></i>
      </div>
      <div class="home-stat-content">
        <div class="home-stat-value"><%= confessions.reduce((sum, c) => sum + c.reactions.like + c.reactions.love + c.reactions.laugh, 0) %></div>
        <div class="home-stat-label">Total Reactions</div>
      </div>
    </div>
  </div>

  <!-- Confessions Feed -->
  <div class="feed-section">
    <div class="feed-header">
      <h2>Recent Confessions</h2>
      <div class="feed-count"><%= confessions.length %> posts</div>
    </div>

    <div class="confessions-feed">
      <% if (confessions.length === 0) { %>
        <div class="empty-state-modern">
          <div class="empty-icon">
            <i class="fas fa-inbox"></i>
          </div>
          <h3>No confessions yet</h3>
          <p>Be the first to share your thoughts anonymously</p>
          <a href="/confessions/new" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            Post First Confession
          </a>
        </div>
      <% } else { %>
        <% confessions.forEach(confession => { %>
          <article class="confession-item">
            <div class="confession-item-header">
              <div class="confession-meta">
                <span class="confession-badge">
                  <i class="fas fa-user-secret"></i>
                  Anonymous
                </span>
                <span class="confession-time">
                  <i class="far fa-clock"></i>
                  <%= getTimeAgo(confession.createdAt) %>
                </span>
              </div>
            </div>
            
            <div class="confession-item-body">
              <p class="confession-content"><%= confession.text %></p>
            </div>
            
            <div class="confession-item-footer">
              <div class="confession-reactions">
                <button 
                  class="reaction-button <%= confession.userReaction === 'like' ? 'active' : '' %>" 
                  onclick="addReaction('<%= confession._id %>', 'like', this)"
                  data-reaction="like"
                  title="Like"
                >
                  <i class="fas fa-thumbs-up"></i>
                  <span id="like-<%= confession._id %>"><%= confession.reactions.like %></span>
                </button>
                <button 
                  class="reaction-button <%= confession.userReaction === 'love' ? 'active' : '' %>" 
                  onclick="addReaction('<%= confession._id %>', 'love', this)"
                  data-reaction="love"
                  title="Love"
                >
                  <i class="fas fa-heart"></i>
                  <span id="love-<%= confession._id %>"><%= confession.reactions.love %></span>
                </button>
                <button 
                  class="reaction-button <%= confession.userReaction === 'laugh' ? 'active' : '' %>" 
                  onclick="addReaction('<%= confession._id %>', 'laugh', this)"
                  data-reaction="laugh"
                  title="Laugh"
                >
                  <i class="fas fa-laugh"></i>
                  <span id="laugh-<%= confession._id %>"><%= confession.reactions.laugh %></span>
                </button>
              </div>
              <div class="confession-total">
                <% const total = confession.reactions.like + confession.reactions.love + confession.reactions.laugh; %>
                <% if (total > 0) { %>
                  <span class="total-count">
                    <i class="fas fa-fire"></i>
                    <%= total %> <%= total === 1 ? 'reaction' : 'reactions' %>
                  </span>
                <% } %>
              </div>
            </div>
          </article>
        <% }) %>
      <% } %>
    </div>
  </div>
</div>

<%
function getTimeAgo(date) {
  const now = new Date();
  const past = new Date(date);
  const diffMs = now - past;
  const diffMins = Math.floor(diffMs / 60000);
  const diffHours = Math.floor(diffMs / 3600000);
  const diffDays = Math.floor(diffMs / 86400000);
  
  if (diffMins < 1) return 'Just now';
  if (diffMins < 60) return diffMins + 'm ago';
  if (diffHours < 24) return diffHours + 'h ago';
  if (diffDays < 7) return diffDays + 'd ago';
  return past.toLocaleDateString();
}
%>

<%- include('partials/footer') %>

<%- include('partials/header') %>

<div class="container">
  <% if (error) { %>
    <div class="alert alert-error">
      <i class="fas fa-exclamation-circle"></i>
      <span><%= error %></span>
    </div>
  <% } %>
  
  <% if (success) { %>
    <div class="alert alert-success">
      <i class="fas fa-check-circle"></i>
      <span><%= success %></span>
    </div>
  <% } %>

  <div class="page-header">
    <h1>
      <i class="fas fa-history"></i>
      My Confession History
    </h1>
    <p class="subtitle">Manage all your anonymous confessions</p>
  </div>

  <div class="history-stats">
    <div class="stat-card">
      <i class="fas fa-comment-dots"></i>
      <div>
        <strong><%= confessions.length %></strong>
        <span>Total Confessions</span>
      </div>
    </div>
    <div class="stat-card">
      <i class="fas fa-heart"></i>
      <div>
        <strong><%= confessions.reduce((sum, c) => sum + c.reactions.like + c.reactions.love + c.reactions.laugh, 0) %></strong>
        <span>Total Reactions</span>
      </div>
    </div>
  </div>

  <div class="history-list">
    <% if (confessions.length === 0) { %>
      <div class="empty-state">
        <i class="fas fa-inbox"></i>
        <h3>No confessions yet</h3>
        <p>You haven't posted any confessions. Start sharing your thoughts!</p>
        <a href="/confessions/new" class="btn btn-primary">
          <i class="fas fa-plus"></i>
          Create Your First Confession
        </a>
      </div>
    <% } else { %>
      <% confessions.forEach(confession => { %>
        <div class="history-card">
          <div class="history-header">
            <span class="date">
              <i class="far fa-calendar"></i>
              <%= new Date(confession.createdAt).toLocaleDateString('en-US', { 
                year: 'numeric',
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
              }) %>
            </span>
            <div class="history-actions">
              <button class="btn-icon btn-edit" onclick="editConfession('<%= confession._id %>', `<%= confession.text.replace(/`/g, '\\`').replace(/\n/g, '\\n') %>`)" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn-icon btn-delete" onclick="deleteConfession('<%= confession._id %>')" title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
          
          <p class="history-text"><%= confession.text %></p>
          
          <div class="history-footer">
            <div class="reaction-stats">
              <span class="reaction-stat">
                <i class="fas fa-thumbs-up"></i>
                <%= confession.reactions.like %>
              </span>
              <span class="reaction-stat">
                <i class="fas fa-heart"></i>
                <%= confession.reactions.love %>
              </span>
              <span class="reaction-stat">
                <i class="fas fa-laugh"></i>
                <%= confession.reactions.laugh %>
              </span>
            </div>
          </div>
        </div>
      <% }) %>
    <% } %>
  </div>
</div>

<!-- Modal for Edit/Delete -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <div id="modal-body"></div>
  </div>
</div>

<%- include('partials/footer') %>

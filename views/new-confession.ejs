<%- include('partials/header') %>

<div class="container">
  <% if (error) { %>
    <div class="alert alert-error">
      <i class="fas fa-exclamation-circle"></i>
      <span><%= error %></span>
    </div>
  <% } %>
  
  <% if (success) { %>
    <div class="alert alert-success">
      <i class="fas fa-check-circle"></i>
      <span><%= success %></span>
    </div>
  <% } %>

  <!-- Page Header -->
  <div class="new-confession-header">
    <div class="new-confession-header-content">
      <div class="header-icon">
        <i class="fas fa-pen-fancy"></i>
      </div>
      <div>
        <h1>Create New Confession</h1>
        <p>Share your thoughts anonymously with the community</p>
      </div>
    </div>
  </div>

  <!-- Main Form Layout -->
  <div class="new-confession-layout">
    <!-- Main Form -->
    <div class="new-confession-main">
      <form action="/confessions" method="POST" class="confession-form">
        <!-- Confession Text -->
        <div class="form-section">
          <div class="form-section-header">
            <h3>Your Confession</h3>
            <span class="char-counter-badge">
              <span id="charCount">0</span> / 500
            </span>
          </div>
          <textarea 
            id="text"
            name="text" 
            placeholder="What's on your mind? Share your thoughts, feelings, or experiences..." 
            required
            maxlength="500"
            rows="8"
            class="confession-textarea"
          ></textarea>
        </div>

        <!-- Secret Code -->
        <div class="form-section">
          <div class="form-section-header">
            <h3>Secret Code</h3>
            <span class="required-badge">Required</span>
          </div>
          <input 
            type="password" 
            id="secretCode"
            name="secretCode" 
            placeholder="Create a secret code (minimum 4 characters)" 
            minlength="4" 
            required
            class="secret-code-input"
          >
          <div class="form-hint-modern">
            <i class="fas fa-info-circle"></i>
            <span>Save this code securely. You'll need it to edit or delete your confession later.</span>
          </div>
        </div>

        <!-- Privacy Notice -->
        <div class="privacy-notice-card">
          <div class="privacy-icon">
            <i class="fas fa-shield-alt"></i>
          </div>
          <div class="privacy-content">
            <h4>Your Privacy is Protected</h4>
            <p>Your confession will be posted completely anonymously. Only you can manage it using your secret code.</p>
          </div>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn-submit-confession">
          <i class="fas fa-paper-plane"></i>
          <span>Post Confession</span>
        </button>
      </form>
    </div>

    <!-- Sidebar -->
    <div class="new-confession-sidebar">
      <!-- Guidelines Card -->
      <div class="sidebar-card">
        <div class="sidebar-card-header">
          <i class="fas fa-list-check"></i>
          <h3>Guidelines</h3>
        </div>
        <ul class="guidelines-list">
          <li>
            <div class="guideline-icon">
              <i class="fas fa-heart"></i>
            </div>
            <div class="guideline-content">
              <strong>Be Authentic</strong>
              <span>Share your genuine thoughts and feelings</span>
            </div>
          </li>
          <li>
            <div class="guideline-icon">
              <i class="fas fa-handshake"></i>
            </div>
            <div class="guideline-content">
              <strong>Respect Others</strong>
              <span>Keep your confession respectful and kind</span>
            </div>
          </li>
          <li>
            <div class="guideline-icon">
              <i class="fas fa-key"></i>
            </div>
            <div class="guideline-content">
              <strong>Remember Your Code</strong>
              <span>Store your secret code in a safe place</span>
            </div>
          </li>
          <li>
            <div class="guideline-icon">
              <i class="fas fa-user-secret"></i>
            </div>
            <div class="guideline-content">
              <strong>Stay Anonymous</strong>
              <span>Your identity is completely protected</span>
            </div>
          </li>
        </ul>
      </div>

      <!-- Quick Stats Card -->
      <div class="sidebar-card">
        <div class="sidebar-card-header">
          <i class="fas fa-chart-simple"></i>
          <h3>Community Stats</h3>
        </div>
        <div class="quick-stats">
          <div class="quick-stat-item">
            <div class="quick-stat-value">500</div>
            <div class="quick-stat-label">Character Limit</div>
          </div>
          <div class="quick-stat-item">
            <div class="quick-stat-value">100%</div>
            <div class="quick-stat-label">Anonymous</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const textarea = document.getElementById('text');
  const charCount = document.getElementById('charCount');
  const charCountBadge = document.querySelector('.char-counter-badge');
  
  textarea.addEventListener('input', function() {
    const length = this.value.length;
    charCount.textContent = length;
    
    // Change color based on character count
    if (length > 450) {
      charCountBadge.style.background = '#fef2f2';
      charCountBadge.style.color = '#dc2626';
    } else if (length > 400) {
      charCountBadge.style.background = '#fef3c7';
      charCountBadge.style.color = '#d97706';
    } else {
      charCountBadge.style.background = '#eff6ff';
      charCountBadge.style.color = '#1d4ed8';
    }
  });
</script>

<%- include('partials/footer') %>
